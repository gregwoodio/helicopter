<!DOCTYPE html>
<html>

<head>
<title>Helicopter Game</title>
<!-- 
Made by Greg Wood, February 5, 2014
-->
<style>

canvas {
	border: 1px solid black;
	margin-left: auto;
	margin-right: auto;
	display: block;
}

img {
	display: none;
}

.instructions {
	text-align: center;
}
</style>

<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

</head>

<body>

<canvas id="canvas" height="500" width="750" onmousedown="if (game == false) {resetGame();} else {rise();	}" onmouseup="fall()"></canvas>
<!--
<button onclick="scrollWall()">Scroll</button>
-->
<img id="helicopterRise" src="helicopterRise.png"/>
<img id="helicopterFall" src="helicopterFall.png" />
<img id="boom" src="boom.png" />
<div class="instructions">
Push any key or click on the game to make the helicopter rise. Don't hit the walls!<br>
Push F5 to reload if you die.
</div>

<script>

var c = document.getElementById("canvas");
var ctx = c.getContext("2d");
var h = 220; //starting height of the helicopter
var p = 400; //the height of the passage, this decreases as the game goes on
var isFalling = true;
var game = true;
var walls = new Array();
var counter = 0;
var score = 0;
var scoreModifier = 1;
var helicopterRise = document.getElementById("helicopterRise");
var helicopterFall = document.getElementById("helicopterFall");
var boom = document.getElementById("boom");
var wallColour = "#33CC44";
var spaceColour = "white";

for (i = 0; i < 101; i++) { //here we're making 25 sections of wall, even though 0-24 only show at once. The extra scrolls in.
	walls[i] = new Array();
}
var variance = 15; //The maximum difference by which the walls change

ctx.fillStyle="blue";
ctx.fillRect(60,(h+20),20,20);

function setWallStart() {
	//Find a starting position for the walls. The rest of the walls will be based on this first one.
	walls[0] = new Array();
	walls[0][0] = p;
	walls[0][1] = Math.floor(Math.random() * (500 - p));
	walls[0][2] = 500 - walls[0][0] - walls[0][1];
	
	//fill in the rest of the array of the walls.
	for (i = 1; i < walls.length; i++) { //there are 50 sections of wall, we've already done the first
		walls[i][0] = p;
		walls[i][1] = walls[i-1][1] + Math.floor(Math.random() * variance * 2 - variance);
		
		if (walls[i][1] < 1) {
			walls[i][1] = 5; //Make sure the walls don't go off the board.
		}
		walls[i][2] = 500 - walls[i][0] - walls[i][1];
		if (walls[i][2] < 1) {
			walls[i][2] = 5;
		}
	}
	
	for (i = 0; i < (walls.length - 1); i++) {
		//draw the walls
		//top wall
		ctx.fillStyle = wallColour;
		ctx.fillRect((i * 8), 0, 8, walls[i][1]); 
		//bottom wall
		ctx.fillStyle = wallColour;
		ctx.fillRect((i * 8), (500-walls[i][2]), 8, 500); 
	}
}


function rise() {
	if (game == true) {
		isFalling = false;
		ctx.fillStyle = spaceColour;
		ctx.fillRect(60,(h+20),20,20);
		h-=3;
		ctx.drawImage(helicopterRise,60,(h + 20));
	}
}

function fall() {
	if (game == true) {
		isFalling = true;
		ctx.fillStyle = spaceColour;
		ctx.fillRect(60,(h+20),20,20);
		h+=1;
		ctx.drawImage(helicopterFall,60,(h + 20));
	}
}

function scrollWall() {
	//This scrolls the wall in from the right.
	counter += 5;
	score += (1 * scoreModifier);
	
	if ((counter % 30) == 0) {
		
		//shift the array over one, make a new value for the last section
		for (i = 0; i < 100; i++) {
			console.log("walls[" + i + "] = " + walls[i] + " is now walls[" + (i + 1) + "] = " + walls[(i+1)]);
			walls[i] = walls[i+1];
		}
		
		walls[100] = new Array();
		walls[100][0] = p;
		walls[100][1] = walls[99][1] + Math.floor(Math.random() * variance * 2 - variance);
		
		if (walls[100][1] < 1) {
			walls[100][1] = 5;
		}
		
		walls[100][2] =  500 - walls[100][0] - walls[100][1];
		
		if (walls[100][2] < 1) {
			walls[100][2] = 5;
		}
		
		console.log(walls);
	}
	/*
	if (score > 2500) {
		trollJake();
	}
	*/
	
	//This makes the game harder as it goes. The passageway gets narrower every 300 counters.
	if (counter % 500 == 0) {
		if (p > 150) {
			p -= 5;
		} else if (p < 150) {
			variance += 5;
		}
	}
	
	//This changes the colour of the walls as you go.
	
	if (counter > 30000) {
		wallColour = "#336644";
	} else if (counter > 25000) {
		wallColour = "#337744";
	} else if (counter > 20000) {
		wallColour = "#338844";
	} else if (counter > 15000) {
		wallColour = "#339944";
	} else if (counter > 10000) {
		wallColour = "#33AA44";
	} else if (counter > 5000) {
		wallColour = "#33BB44";
	}
	//first erase the old walls
	ctx.fillStyle = spaceColour;
	ctx.fillRect(0, 0, 750, 500);
	
	if (isFalling == true) {
		fall();
	} else if (isFalling == false) {
		rise();
	}
		
	for (i = 0; i < (walls.length - 1); i++) {
		//draw the walls
		//top wall
		ctx.fillStyle = wallColour;
		ctx.fillRect((i * 8), 0, 8, walls[i][1]); 
		//bottom wall
		ctx.fillStyle = wallColour;
		ctx.fillRect((i * 8), (500-walls[i][2]), 8, 500); 
	}
	
	checkLose();
	
	//draw the score.
	ctx.fillStyle = "black";
	ctx.font = "30px Arial";
	ctx.fillText("Score: " + score, 550, 480);
}

function checkLose() {
	if ((h + 20) < walls[8][1] ) {
		//add an explosion
		ctx.drawImage(boom,50,(h+10));
		game = false;
		//add the "Play again?" text.
		ctx.fillStyle = "black";
		ctx.font = "30px Arial";
		ctx.fillText("Press any key to play again", 185, 250);
	} else if ((h+40) > (500 - walls[8][2])) {
		console.log("Crashed at " + (500 - walls[8][2] + 40));
		//add an explosion
		ctx.drawImage(boom,50,(h));
		game = false;
		//add the "Play again?" text.
		ctx.fillStyle = "black";
		ctx.font = "30px Arial";
		ctx.fillText("Press any key to play again", 185, 250);
	}
}


setInterval(function() {
	if (game == true) {
		
		scrollWall();
			
		
	}
}, 1);

function resetGame() {
	game = true;
	score = 0;
	counter = 0;
	isFalling = true;
	h = 220; //starting height of the helicopter
	p = 400; //the height of the passage, this decreases as the game goes on
	wallColour = "#33CC44";
	spaceColour = "white";
	walls = new Array();	
	for (i = 0; i < 101; i++) { //here we're making 25 sections of wall, even though 0-24 only show at once. The extra scrolls in.
		walls[i] = new Array();
	}
	var variance = 15; //The maximum difference by which the walls change
	setWallStart();
}

/*
//Troll your friends by calling this method to RickRoll them.
function trollJake() {
	window.location.replace("https://www.youtube.com/v/oHg5SJYRHA0&autoplay=1");
}
*/

$(document).keypress(function(event) {
	if (game == false) {
		resetGame();
	} else {
		rise();
	}
});

$(document).keyup(function(event) {
	fall();
});

setWallStart();
</script>

</body>
</html>